/*
 * SeeedOLED.cpp
 * SSD130x OLED Driver Library
 *
 * Copyright (c) 2011 seeed technology inc.
 * Author        :   Visweswara R
 * Create Time   :   Dec 2011
 * Change Log    :
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
 */

#include "Wire.h"
#include "SeeedOLED.h"

#include <avr/pgmspace.h>

#define MAX_DATA_CHUNK 31  // The Arduino has a 32 byte limit and the OLED wants a "Data" indicator byte

#if 0
// 8x8 Font ASCII 32 - 127 Implemented
// Users can modify this to support more characters(glyphs)
// BasicFont is placed in code memory.

// This font be freely used without any restriction(It is placed in public domain)
const unsigned char BasicFont[][8] PROGMEM=
{
  {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
  {0x00,0x00,0x5F,0x00,0x00,0x00,0x00,0x00},
  {0x00,0x00,0x07,0x00,0x07,0x00,0x00,0x00},
  {0x00,0x14,0x7F,0x14,0x7F,0x14,0x00,0x00},
  {0x00,0x24,0x2A,0x7F,0x2A,0x12,0x00,0x00},
  {0x00,0x23,0x13,0x08,0x64,0x62,0x00,0x00},
  {0x00,0x36,0x49,0x55,0x22,0x50,0x00,0x00},
  {0x00,0x00,0x05,0x03,0x00,0x00,0x00,0x00},
  {0x00,0x1C,0x22,0x41,0x00,0x00,0x00,0x00},
  {0x00,0x41,0x22,0x1C,0x00,0x00,0x00,0x00},
  {0x00,0x08,0x2A,0x1C,0x2A,0x08,0x00,0x00},
  {0x00,0x08,0x08,0x3E,0x08,0x08,0x00,0x00},
  {0x00,0xA0,0x60,0x00,0x00,0x00,0x00,0x00},
  {0x00,0x08,0x08,0x08,0x08,0x08,0x00,0x00},
  {0x00,0x60,0x60,0x00,0x00,0x00,0x00,0x00},
  {0x00,0x20,0x10,0x08,0x04,0x02,0x00,0x00},
  {0x00,0x3E,0x51,0x49,0x45,0x3E,0x00,0x00},
  {0x00,0x00,0x42,0x7F,0x40,0x00,0x00,0x00},
  {0x00,0x62,0x51,0x49,0x49,0x46,0x00,0x00},
  {0x00,0x22,0x41,0x49,0x49,0x36,0x00,0x00},
  {0x00,0x18,0x14,0x12,0x7F,0x10,0x00,0x00},
  {0x00,0x27,0x45,0x45,0x45,0x39,0x00,0x00},
  {0x00,0x3C,0x4A,0x49,0x49,0x30,0x00,0x00},
  {0x00,0x01,0x71,0x09,0x05,0x03,0x00,0x00},
  {0x00,0x36,0x49,0x49,0x49,0x36,0x00,0x00},
  {0x00,0x06,0x49,0x49,0x29,0x1E,0x00,0x00},
  {0x00,0x00,0x36,0x36,0x00,0x00,0x00,0x00},
  {0x00,0x00,0xAC,0x6C,0x00,0x00,0x00,0x00},
  {0x00,0x08,0x14,0x22,0x41,0x00,0x00,0x00},
  {0x00,0x14,0x14,0x14,0x14,0x14,0x00,0x00},
  {0x00,0x41,0x22,0x14,0x08,0x00,0x00,0x00},
  {0x00,0x02,0x01,0x51,0x09,0x06,0x00,0x00},
  {0x00,0x32,0x49,0x79,0x41,0x3E,0x00,0x00},
  {0x00,0x7E,0x09,0x09,0x09,0x7E,0x00,0x00},
  {0x00,0x7F,0x49,0x49,0x49,0x36,0x00,0x00},
  {0x00,0x3E,0x41,0x41,0x41,0x22,0x00,0x00},
  {0x00,0x7F,0x41,0x41,0x22,0x1C,0x00,0x00},
  {0x00,0x7F,0x49,0x49,0x49,0x41,0x00,0x00},
  {0x00,0x7F,0x09,0x09,0x09,0x01,0x00,0x00},
  {0x00,0x3E,0x41,0x41,0x51,0x72,0x00,0x00},
  {0x00,0x7F,0x08,0x08,0x08,0x7F,0x00,0x00},
  {0x00,0x41,0x7F,0x41,0x00,0x00,0x00,0x00},
  {0x00,0x20,0x40,0x41,0x3F,0x01,0x00,0x00},
  {0x00,0x7F,0x08,0x14,0x22,0x41,0x00,0x00},
  {0x00,0x7F,0x40,0x40,0x40,0x40,0x00,0x00},
  {0x00,0x7F,0x02,0x0C,0x02,0x7F,0x00,0x00},
  {0x00,0x7F,0x04,0x08,0x10,0x7F,0x00,0x00},
  {0x00,0x3E,0x41,0x41,0x41,0x3E,0x00,0x00},
  {0x00,0x7F,0x09,0x09,0x09,0x06,0x00,0x00},
  {0x00,0x3E,0x41,0x51,0x21,0x5E,0x00,0x00},
  {0x00,0x7F,0x09,0x19,0x29,0x46,0x00,0x00},
  {0x00,0x26,0x49,0x49,0x49,0x32,0x00,0x00},
  {0x00,0x01,0x01,0x7F,0x01,0x01,0x00,0x00},
  {0x00,0x3F,0x40,0x40,0x40,0x3F,0x00,0x00},
  {0x00,0x1F,0x20,0x40,0x20,0x1F,0x00,0x00},
  {0x00,0x3F,0x40,0x38,0x40,0x3F,0x00,0x00},
  {0x00,0x63,0x14,0x08,0x14,0x63,0x00,0x00},
  {0x00,0x03,0x04,0x78,0x04,0x03,0x00,0x00},
  {0x00,0x61,0x51,0x49,0x45,0x43,0x00,0x00},
  {0x00,0x7F,0x41,0x41,0x00,0x00,0x00,0x00},
  {0x00,0x02,0x04,0x08,0x10,0x20,0x00,0x00},
  {0x00,0x41,0x41,0x7F,0x00,0x00,0x00,0x00},
  {0x00,0x04,0x02,0x01,0x02,0x04,0x00,0x00},
  {0x00,0x80,0x80,0x80,0x80,0x80,0x00,0x00},
  {0x00,0x01,0x02,0x04,0x00,0x00,0x00,0x00},
  {0x00,0x20,0x54,0x54,0x54,0x78,0x00,0x00},
  {0x00,0x7F,0x48,0x44,0x44,0x38,0x00,0x00},
  {0x00,0x38,0x44,0x44,0x28,0x00,0x00,0x00},
  {0x00,0x38,0x44,0x44,0x48,0x7F,0x00,0x00},
  {0x00,0x38,0x54,0x54,0x54,0x18,0x00,0x00},
  {0x00,0x08,0x7E,0x09,0x02,0x00,0x00,0x00},
  {0x00,0x18,0xA4,0xA4,0xA4,0x7C,0x00,0x00},
  {0x00,0x7F,0x08,0x04,0x04,0x78,0x00,0x00},
  {0x00,0x00,0x7D,0x00,0x00,0x00,0x00,0x00},
  {0x00,0x80,0x84,0x7D,0x00,0x00,0x00,0x00},
  {0x00,0x7F,0x10,0x28,0x44,0x00,0x00,0x00},
  {0x00,0x41,0x7F,0x40,0x00,0x00,0x00,0x00},
  {0x00,0x7C,0x04,0x18,0x04,0x78,0x00,0x00},
  {0x00,0x7C,0x08,0x04,0x7C,0x00,0x00,0x00},
  {0x00,0x38,0x44,0x44,0x38,0x00,0x00,0x00},
  {0x00,0xFC,0x24,0x24,0x18,0x00,0x00,0x00},
  {0x00,0x18,0x24,0x24,0xFC,0x00,0x00,0x00},
  {0x00,0x00,0x7C,0x08,0x04,0x00,0x00,0x00},
  {0x00,0x48,0x54,0x54,0x24,0x00,0x00,0x00},
  {0x00,0x04,0x7F,0x44,0x00,0x00,0x00,0x00},
  {0x00,0x3C,0x40,0x40,0x7C,0x00,0x00,0x00},
  {0x00,0x1C,0x20,0x40,0x20,0x1C,0x00,0x00},
  {0x00,0x3C,0x40,0x30,0x40,0x3C,0x00,0x00},
  {0x00,0x44,0x28,0x10,0x28,0x44,0x00,0x00},
  {0x00,0x1C,0xA0,0xA0,0x7C,0x00,0x00,0x00},
  {0x00,0x44,0x64,0x54,0x4C,0x44,0x00,0x00},
  {0x00,0x08,0x36,0x41,0x00,0x00,0x00,0x00},
  {0x00,0x00,0x7F,0x00,0x00,0x00,0x00,0x00},
  {0x00,0x41,0x36,0x08,0x00,0x00,0x00,0x00},
  {0x00,0x02,0x01,0x01,0x02,0x01,0x00,0x00},
  {0x00,0x02,0x05,0x05,0x02,0x00,0x00,0x00} 
};
#endif
// Nx24 Font ASCII 32 - 126 Implemented

const uint8_t TickerFont_widths[] PROGMEM = {
    5, 4, 7, 14, 12, 14, 11, 7, 6, 6, 9, 8, 5, 7, 4, 9, 10, 8, 10, 10, 10, 10, 10, 10, 10, 10, 5, 5, 6, 9, 6, 9, 16, 12, 11, 10, 12, 11, 10, 12, 13, 9, 11, 10, 9, 15, 14, 14, 9, 15, 11, 12, 12, 13, 11, 18, 12, 11, 12, 6, 9, 6, 10, 11, 9, 9, 10, 9, 10, 9, 9, 9, 10, 5, 7, 9, 5, 13, 9, 9, 9, 9, 8, 8, 8, 9, 8, 12, 10, 9, 9, 6, 7, 6, 10};
const uint16_t TickerFont_offsets[] PROGMEM = {
    0, 15, 27, 48, 90, 126, 168, 201, 222, 240, 258, 285, 309, 324, 345, 357, 384, 414, 438, 468, 498, 528, 558, 588, 618, 648, 678, 693, 708, 726, 753, 771, 798, 846, 882, 915, 945, 981, 1014, 1044, 1080, 1119, 1146, 1179, 1209, 1236, 1281, 1323, 1365, 1392, 1437, 1470, 1506, 1542, 1581, 1614, 1668, 1704, 1737, 1773, 1791, 1818, 1836, 1866, 1899, 1926, 1953, 1983, 2010, 2040, 2067, 2094, 2121, 2151, 2166, 2187, 2214, 2229, 2268, 2295, 2322, 2349, 2376, 2400, 2424, 2448, 2475, 2499, 2535, 2565, 2592, 2619, 2637, 2658, 2676};
const uint8_t TickerFont_data[] PROGMEM = {
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    224, 224, 0, 0, 255, 255, 0, 0, 255, 255, 0, 0, 192, 192, 0, 0,
    192, 192, 0, 255, 255, 0, 0, 255, 255, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 192, 192, 0, 0, 0, 192, 192, 0, 0, 192, 254,
    254, 254, 254, 255, 255, 254, 254, 254, 255, 255, 254, 254, 0, 0, 254, 255,
    255, 0, 0, 254, 255, 255, 0, 0, 0, 0, 0, 0, 128, 128, 192, 240,
    240, 192, 192, 128, 0, 0, 0, 255, 255, 255, 248, 255, 255, 248, 248, 240,
    224, 0, 0, 255, 255, 254, 254, 255, 255, 254, 255, 255, 255, 0, 128, 192,
    192, 192, 192, 128, 0, 128, 224, 192, 0, 0, 0, 0, 255, 255, 254, 254,
    255, 255, 254, 255, 255, 192, 192, 192, 128, 0, 0, 0, 0, 254, 255, 255,
    0, 255, 255, 254, 254, 255, 255, 0, 0, 0, 0, 128, 192, 192, 192, 128,
    0, 0, 0, 192, 240, 240, 255, 255, 252, 255, 255, 192, 248, 0, 255, 255,
    255, 254, 254, 254, 254, 255, 255, 255, 252, 0, 0, 192, 192, 0, 0, 0,
    0, 0, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 192, 224, 224, 0, 248, 255, 255, 0, 0, 0, 255, 255, 252, 240, 224,
    224, 224, 192, 0, 0, 0, 0, 0, 255, 255, 248, 0, 224, 240, 252, 255,
    255, 0, 0, 0, 0, 192, 0, 0, 0, 0, 0, 255, 255, 255, 255, 255,
    255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 240, 240, 240, 254, 254, 240, 240, 240, 0, 0, 0,
    255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    240, 252, 252, 0, 0, 0, 0, 0, 0, 0, 0, 0, 224, 224, 224, 224,
    224, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 254, 254, 0, 0, 0, 0, 0, 0, 0, 128, 192, 0, 0, 0,
    0, 192, 240, 254, 255, 255, 0, 0, 252, 255, 255, 0, 0, 0, 0, 0,
    0, 0, 128, 192, 192, 192, 192, 128, 0, 0, 254, 255, 255, 0, 0, 0,
    255, 255, 254, 0, 0, 255, 255, 254, 254, 254, 255, 255, 0, 0, 0, 0,
    128, 192, 192, 0, 0, 0, 0, 255, 255, 255, 255, 0, 0, 0, 0, 254,
    254, 255, 255, 254, 254, 0, 0, 0, 128, 192, 192, 192, 192, 128, 128, 0,
    0, 255, 255, 255, 224, 240, 255, 255, 255, 0, 0, 255, 255, 254, 254, 254,
    254, 254, 254, 0, 0, 128, 128, 192, 192, 192, 192, 128, 0, 0, 0, 255,
    255, 248, 248, 248, 252, 255, 255, 0, 0, 255, 255, 254, 254, 254, 255, 255,
    255, 0, 0, 0, 0, 0, 0, 128, 192, 192, 0, 0, 224, 240, 248, 252,
    255, 255, 255, 255, 224, 224, 0, 0, 0, 0, 0, 0, 255, 255, 0, 0,
    0, 192, 192, 192, 192, 192, 192, 192, 192, 0, 0, 255, 255, 254, 254, 254,
    254, 252, 248, 0, 0, 255, 255, 254, 254, 254, 255, 255, 0, 0, 0, 0,
    0, 0, 128, 192, 192, 0, 0, 0, 0, 248, 254, 255, 255, 255, 248, 240,
    224, 0, 0, 255, 255, 255, 254, 254, 255, 255, 255, 0, 192, 192, 192, 192,
    192, 192, 192, 192, 192, 192, 0, 0, 0, 192, 240, 252, 254, 255, 255, 0,
    0, 0, 254, 255, 0, 0, 0, 0, 0, 0, 0, 128, 192, 192, 192, 192,
    192, 128, 128, 0, 255, 255, 255, 248, 248, 248, 252, 255, 255, 0, 255, 255,
    255, 254, 254, 254, 255, 255, 255, 0, 0, 128, 192, 192, 192, 192, 192, 128,
    0, 0, 255, 255, 255, 224, 224, 224, 255, 255, 255, 0, 0, 252, 252, 252,
    254, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 252, 252, 0,
    0, 0, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 252, 252, 0, 0,
    252, 254, 254, 0, 0, 0, 0, 0, 0, 0, 224, 240, 248, 252, 252, 0,
    0, 0, 0, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    252, 252, 252, 252, 252, 252, 0, 0, 0, 255, 255, 255, 255, 255, 255, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 252, 252, 248, 240, 224, 0, 255, 255,
    255, 0, 0, 0, 0, 0, 128, 128, 128, 0, 0, 0, 0, 255, 255, 255,
    255, 255, 255, 255, 252, 0, 0, 252, 255, 0, 0, 0, 0, 0, 0, 0,
    0, 128, 192, 224, 224, 224, 224, 224, 224, 192, 192, 128, 0, 0, 0, 252,
    255, 255, 248, 252, 254, 254, 254, 248, 224, 224, 255, 255, 254, 0, 0, 0,
    255, 255, 254, 254, 252, 252, 252, 252, 254, 254, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 128, 192, 0, 0, 0, 0, 0, 192, 224, 248, 254,
    255, 255, 255, 254, 128, 0, 0, 254, 255, 255, 0, 0, 0, 0, 0, 255,
    255, 0, 0, 192, 192, 192, 192, 192, 128, 128, 0, 0, 0, 0, 255, 255,
    240, 240, 240, 255, 255, 255, 192, 0, 0, 255, 255, 254, 254, 254, 255, 255,
    255, 255, 0, 0, 0, 0, 128, 192, 192, 192, 192, 192, 0, 240, 252, 255,
    255, 255, 0, 0, 255, 255, 0, 255, 255, 255, 254, 254, 254, 255, 255, 255,
    0, 0, 192, 192, 128, 128, 128, 0, 0, 0, 0, 0, 0, 0, 255, 255,
    0, 255, 255, 255, 255, 254, 252, 248, 0, 0, 255, 255, 254, 254, 254, 254,
    255, 255, 255, 0, 0, 0, 192, 192, 192, 192, 192, 192, 192, 192, 192, 0,
    0, 255, 255, 248, 248, 248, 248, 248, 248, 0, 0, 0, 255, 255, 254, 254,
    254, 254, 254, 254, 0, 0, 0, 192, 192, 192, 192, 192, 192, 192, 192, 128,
    0, 255, 255, 248, 248, 248, 248, 248, 248, 0, 0, 255, 255, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 128, 192, 192, 192, 192, 128, 128, 0, 0,
    240, 252, 255, 255, 255, 240, 240, 240, 255, 255, 240, 0, 255, 255, 255, 254,
    254, 254, 254, 255, 255, 255, 0, 0, 0, 192, 192, 0, 0, 0, 0, 0,
    0, 0, 192, 192, 0, 0, 255, 255, 224, 224, 224, 240, 240, 240, 240, 255,
    255, 0, 0, 255, 255, 0, 0, 0, 0, 0, 0, 0, 255, 255, 0, 192,
    192, 192, 192, 192, 192, 192, 192, 0, 0, 0, 0, 255, 255, 0, 0, 0,
    0, 254, 254, 254, 255, 255, 254, 254, 254, 0, 0, 0, 0, 192, 192, 192,
    192, 192, 192, 192, 192, 192, 192, 0, 0, 0, 0, 255, 255, 0, 0, 0,
    255, 255, 255, 254, 254, 255, 255, 255, 0, 0, 0, 0, 192, 192, 0, 0,
    0, 0, 0, 128, 192, 0, 255, 255, 248, 252, 252, 254, 255, 255, 0, 0,
    255, 255, 0, 0, 255, 255, 255, 254, 254, 0, 192, 192, 0, 0, 0, 0,
    0, 0, 0, 255, 255, 0, 0, 0, 0, 0, 0, 0, 255, 255, 254, 254,
    254, 254, 254, 0, 0, 0, 0, 128, 192, 192, 0, 0, 0, 128, 192, 128,
    0, 0, 0, 0, 128, 248, 255, 255, 255, 248, 0, 240, 255, 255, 255, 248,
    0, 0, 0, 255, 255, 0, 0, 0, 255, 255, 255, 0, 0, 255, 255, 254,
    0, 0, 192, 192, 128, 0, 0, 0, 0, 0, 0, 0, 192, 128, 0, 0,
    255, 255, 255, 254, 252, 248, 240, 192, 128, 0, 255, 255, 0, 0, 255, 255,
    0, 0, 0, 0, 0, 0, 255, 255, 255, 255, 0, 0, 0, 0, 0, 128,
    192, 192, 192, 192, 192, 128, 128, 0, 0, 0, 248, 254, 255, 255, 255, 0,
    0, 0, 0, 255, 255, 255, 0, 0, 0, 255, 255, 255, 254, 254, 254, 254,
    255, 255, 0, 0, 0, 0, 192, 192, 192, 192, 192, 128, 0, 0, 0, 255,
    255, 240, 240, 255, 255, 255, 0, 0, 255, 255, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 128, 192, 192, 192, 192, 192, 192, 128, 0, 0, 0, 0,
    252, 254, 255, 255, 255, 0, 192, 128, 0, 255, 255, 255, 252, 0, 0, 0,
    255, 255, 255, 254, 254, 254, 255, 255, 254, 255, 255, 240, 0, 0, 192, 192,
    192, 192, 128, 128, 0, 0, 0, 0, 0, 255, 255, 224, 224, 255, 255, 255,
    254, 0, 0, 0, 255, 255, 0, 0, 0, 255, 255, 255, 254, 0, 0, 0,
    0, 128, 128, 192, 192, 192, 192, 128, 0, 0, 0, 128, 254, 255, 255, 248,
    248, 248, 248, 240, 224, 0, 0, 255, 255, 255, 254, 254, 254, 254, 255, 255,
    255, 0, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 0, 0, 0,
    0, 0, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255,
    0, 0, 0, 0, 0, 0, 0, 192, 192, 0, 0, 0, 0, 0, 0, 0,
    192, 192, 0, 0, 255, 255, 128, 0, 0, 0, 0, 0, 192, 255, 255, 0,
    0, 0, 255, 255, 255, 254, 254, 254, 255, 255, 255, 0, 0, 0, 192, 192,
    0, 0, 0, 0, 0, 0, 192, 192, 0, 255, 255, 254, 224, 0, 192, 248,
    255, 255, 0, 0, 0, 0, 255, 255, 254, 255, 255, 0, 0, 0, 0, 192,
    192, 0, 0, 0, 0, 0, 128, 192, 192, 0, 0, 0, 0, 128, 192, 0,
    0, 255, 255, 255, 240, 0, 224, 252, 255, 255, 255, 252, 0, 192, 248, 255,
    255, 0, 0, 0, 0, 0, 255, 255, 255, 0, 0, 0, 255, 255, 254, 255,
    255, 0, 0, 0, 0, 192, 192, 128, 0, 0, 0, 0, 0, 0, 192, 192,
    0, 0, 255, 255, 255, 254, 248, 252, 254, 255, 255, 0, 0, 254, 255, 255,
    0, 0, 0, 0, 0, 255, 255, 254, 192, 192, 0, 0, 0, 0, 0, 0,
    192, 192, 0, 0, 255, 255, 254, 248, 224, 252, 255, 255, 0, 0, 0, 0,
    0, 254, 255, 255, 0, 0, 0, 0, 0, 0, 192, 192, 192, 192, 192, 192,
    192, 192, 192, 192, 192, 0, 0, 128, 192, 224, 248, 252, 254, 255, 255, 255,
    0, 0, 255, 255, 254, 254, 254, 254, 254, 254, 254, 254, 254, 0, 0, 224,
    224, 224, 224, 0, 0, 255, 255, 0, 0, 0, 0, 255, 255, 224, 224, 0,
    0, 192, 192, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 252, 224, 128,
    0, 0, 0, 0, 0, 0, 0, 255, 255, 252, 224, 224, 224, 224, 224, 0,
    0, 0, 0, 255, 255, 0, 224, 224, 224, 255, 255, 0, 0, 0, 0, 128,
    192, 224, 192, 128, 0, 0, 0, 0, 255, 255, 0, 0, 0, 0, 255, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 224, 0, 224, 224, 192, 128,
    0, 0, 0, 0, 0, 0, 0, 255, 255, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    224, 248, 248, 252, 252, 252, 252, 0, 0, 255, 255, 254, 254, 254, 255, 255,
    254, 0, 224, 224, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 248, 252,
    252, 252, 248, 240, 0, 0, 255, 255, 254, 254, 254, 255, 255, 255, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 224, 248, 252, 252, 252, 252, 248,
    0, 0, 255, 255, 255, 254, 254, 255, 255, 0, 0, 0, 0, 0, 0, 0,
    0, 224, 224, 0, 0, 240, 248, 252, 252, 252, 252, 255, 255, 0, 0, 255,
    255, 255, 254, 254, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 224, 248, 252, 252, 252, 252, 252, 248, 0, 255, 255, 255, 254, 254,
    254, 254, 255, 0, 0, 0, 128, 192, 224, 224, 224, 0, 0, 252, 252, 255,
    255, 252, 252, 252, 0, 0, 0, 0, 255, 255, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 224, 248, 252, 252, 252, 252, 248, 0,
    0, 255, 255, 254, 254, 255, 255, 255, 0, 0, 224, 224, 0, 0, 0, 0,
    0, 0, 0, 0, 255, 255, 248, 252, 252, 252, 248, 0, 0, 0, 255, 255,
    0, 0, 0, 255, 255, 0, 0, 0, 192, 192, 0, 0, 0, 252, 252, 0,
    0, 0, 255, 255, 0, 0, 0, 0, 0, 192, 192, 0, 0, 0, 0, 0,
    252, 252, 0, 0, 240, 192, 192, 255, 255, 0, 0, 0, 224, 224, 0, 0,
    0, 0, 0, 0, 0, 255, 255, 192, 224, 240, 248, 252, 252, 0, 255, 255,
    0, 0, 0, 255, 255, 254, 0, 0, 224, 224, 0, 0, 0, 255, 255, 0,
    0, 0, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 252, 252, 240, 248, 252, 252, 248, 252, 252, 252, 248, 0, 0,
    255, 255, 0, 0, 0, 255, 255, 0, 0, 255, 255, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 252, 252, 248, 252, 252, 252, 248, 0, 0, 255,
    255, 0, 0, 0, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 224, 248, 252, 252, 252, 252, 248, 240, 0, 255, 255, 255, 254, 254, 255,
    255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 254, 254, 248, 252,
    252, 252, 240, 0, 0, 255, 255, 254, 254, 255, 255, 255, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 224, 248, 248, 252, 252, 252, 252, 0, 0,
    255, 255, 254, 254, 254, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 252, 252, 248, 252, 252, 252, 0, 0, 255, 255, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 240, 248, 248, 252, 252, 252, 0,
    0, 254, 254, 254, 254, 255, 255, 0, 0, 0, 0, 128, 128, 0, 0, 0,
    0, 252, 252, 255, 255, 252, 252, 0, 0, 0, 0, 255, 255, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 252, 252, 0, 0, 0, 252,
    252, 0, 0, 255, 255, 254, 254, 254, 255, 255, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 252, 252, 240, 128, 128, 224, 252, 252, 0, 0, 255, 255, 255,
    255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    252, 252, 192, 0, 240, 252, 252, 0, 224, 252, 252, 0, 0, 255, 255, 255,
    255, 0, 255, 254, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 252, 252, 248, 240, 224, 240, 248, 252, 252, 0, 254, 255, 255, 255, 0,
    255, 255, 255, 254, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 252, 252,
    240, 192, 0, 192, 240, 252, 252, 0, 0, 224, 255, 255, 255, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 252, 252, 252, 252, 252, 252,
    252, 252, 0, 254, 255, 255, 255, 254, 254, 254, 254, 0, 128, 192, 224, 224,
    224, 224, 255, 255, 0, 0, 0, 0, 255, 255, 240, 224, 224, 0, 0, 0,
    224, 224, 0, 0, 0, 0, 0, 255, 255, 0, 0, 0, 0, 0, 255, 255,
    0, 0, 224, 224, 224, 192, 0, 0, 0, 0, 255, 255, 224, 192, 224, 224,
    255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 224,
    248, 252, 252, 248, 240, 224, 240, 248, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0};

void SeeedOLED::init(void)
{
    sendCommand(SeeedOLED_Display_Off_Cmd);     //display off
    delay(5); 
    sendCommand(SeeedOLED_Display_On_Cmd);  //display on
    delay(5); 
    sendCommand(SeeedOLED_Normal_Display_Cmd);  //Set Normal Display (default)

    // Set Horizontal addressing
    sendCommand(0x20);          //set addressing mode
    sendCommand(0x00);          //set horizontal addressing mode
}

void SeeedOLED::sendCommand(unsigned char command)
{
  Wire.beginTransmission(SeeedOLED_Address); // begin I2C communication
#if defined(ARDUINO) && ARDUINO >= 100
  Wire.write(SeeedOLED_Command_Mode);        // Set OLED Command mode
  Wire.write(command);
#else
  Wire.send(SeeedOLED_Command_Mode);         // Set OLED Command mode
  Wire.send(command);
#endif
  Wire.endTransmission();                // End I2C communication
}

void SeeedOLED::setBrightness(unsigned char Brightness)
{
   sendCommand(SeeedOLED_Set_Brightness_Cmd);
   sendCommand(Brightness);
}

void SeeedOLED::setTextXY(unsigned char Row, unsigned char Column)
{
    sendCommand(0xB0 + Row);            //set page address
    sendCommand(0x00 + (8*Column & 0x0F));  //set column lower address
    sendCommand(0x10 + ((8*Column>>4)&0x0F));   //set column higher address
}

void SeeedOLED::clearDisplay()
{
  sendCommand(SeeedOLED_Display_Off_Cmd);   //display off
  setTextXY(0, 0);

  uint16_t bytes = 128 * 64 / 8;
  do
  {
      Wire.beginTransmission(SeeedOLED_Address); // begin I2C transmission
      Wire.write(SeeedOLED_Data_Mode);            // data mode
      int chunkSize = min(bytes, MAX_DATA_CHUNK);
      for (int j = 0; j < chunkSize; j++)
          Wire.write(0);
      Wire.endTransmission();                    // stop I2C transmission
      bytes -= chunkSize;
  } while (bytes > 0);
  sendCommand(SeeedOLED_Display_On_Cmd);    //display on
  setTextXY(0,0); // Should be unnecessary
}

void SeeedOLED::sendData(unsigned char Data)
{
     Wire.beginTransmission(SeeedOLED_Address); // begin I2C transmission
#if defined(ARDUINO) && ARDUINO >= 100
     Wire.write(SeeedOLED_Data_Mode);            // data mode
     Wire.write(Data);
#else
     Wire.send(SeeedOLED_Data_Mode);            // data mode
     Wire.send(Data);
#endif
     Wire.endTransmission();                    // stop I2C transmission
}

void SeeedOLED::sendData(unsigned char *Data, int count)
{
     Wire.beginTransmission(SeeedOLED_Address); // begin I2C transmission
#if defined(ARDUINO) && ARDUINO >= 100
     Wire.write(SeeedOLED_Data_Mode);            // data mode
     for (int i = 0; i < count; i++)
        Wire.write(Data[i]);
#else
     Wire.send(SeeedOLED_Data_Mode);            // data mode
     for (int i = 0; i < count; i++)
        Wire.send(Data[i]);
#endif
     Wire.endTransmission();                    // stop I2C transmission
}

void SeeedOLED::drawBitmapFast(unsigned char *bitmaparray,int bytes)
{
  do
  {
      Wire.beginTransmission(SeeedOLED_Address); // begin I2C transmission
      Wire.write(SeeedOLED_Data_Mode);            // data mode
      int chunkSize = min(bytes, MAX_DATA_CHUNK);
      for (int j = 0; j < chunkSize; j++)
      {
          Wire.write(pgm_read_byte(bitmaparray));
          bitmaparray++;
      }
      Wire.endTransmission();                    // stop I2C transmission
      bytes -= chunkSize;
  } while (bytes > 0);
}

#define TICKER_MAX_LENGTH  140 // Tweet length
#define TICKER_CHAR_WIDTH  6 // Max
#define TICKER_CHAR_HEIGHT 24
#define TICKER_PAGES     (TICKER_CHAR_HEIGHT / 8)
#define TICKER_COLUMNS   (TICKER_CHAR_WIDTH * TICKER_MAX_LENGTH)
#define TICKER_RESTART_GAP 16  // columns

static uint8_t tickerBuffer[TICKER_PAGES][TICKER_COLUMNS];
static uint16_t tickerColumn = 0;
static uint16_t tickerMaxColumn = 0;

void SeeedOLED::setTicker(const char *message)
{
    memset(tickerBuffer, 0, sizeof(tickerBuffer));
    uint16_t column = 0;
    while (column <= TICKER_COLUMNS - TICKER_CHAR_WIDTH) {
        char c = pgm_read_byte(message);
        if (c == 0)
            break;
        if (c < 32 || c >= 127)
            c = 32;
        c -= 32;

        uint8_t width = pgm_read_byte(&TickerFont_widths[c]);
        uint16_t offset = pgm_read_word(&TickerFont_offsets[c]);

        for (uint8_t page = 0; page < TICKER_PAGES; page++) {
            for (uint8_t x = 0; x < width; x++) {
                tickerBuffer[page][column + x] = pgm_read_byte(&TickerFont_data[offset + x]);
            }
            offset += width;
        }
        column += width;
        message++;
    }

    tickerColumn = 0;
    tickerMaxColumn = column + TICKER_RESTART_GAP;
    if (tickerMaxColumn < 128)
        tickerMaxColumn = 128;
    else if (tickerMaxColumn > TICKER_COLUMNS)
        tickerMaxColumn = TICKER_COLUMNS;
}

void SeeedOLED::updateTicker()
{
    // Go back to the origin
    sendCommand(0xB0);
    sendCommand(0x00);
    sendCommand(0x10);

    uint16_t bytes = 128 * TICKER_PAGES;
    uint16_t offset = tickerColumn;
    uint16_t offsetStart = offset;
    uint8_t page = 0;
    do
    {
        Wire.beginTransmission(SeeedOLED_Address); // begin I2C transmission
        Wire.write(SeeedOLED_Data_Mode);            // data mode
        int chunkSize = min(bytes, MAX_DATA_CHUNK);
        for (uint16_t j = 0; j < chunkSize; j++)
        {
            Wire.write(tickerBuffer[page][offset]);
            offset++;
            if (offset >= tickerMaxColumn)
                offset = 0;
            if (offset == offsetStart)
                page++;
        }
        Wire.endTransmission();                    // stop I2C transmission
        bytes -= chunkSize;
    } while (bytes > 0);
    tickerColumn++;
    if (tickerColumn >= tickerMaxColumn)
        tickerColumn = 0;
}

void SeeedOLED::setNormalDisplay()
{
    sendCommand(SeeedOLED_Normal_Display_Cmd);
}

void SeeedOLED::setInverseDisplay()
{
    sendCommand(SeeedOLED_Inverse_Display_Cmd);
}


SeeedOLED SeeedOled;  // Preinstantiate Objects

